name: Issue Triage

on:
  issues:
    types: [opened, edited]

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Auto-Assign Admin
        if: github.actor != 'PoojasPatel013'
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'add-assignees'
          token: ${{ secrets.GITHUB_TOKEN }}
          assignees: 'PoojasPatel013'

      - name: Auto-Label based on Title/Body
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body ? context.payload.issue.body.toLowerCase() : "";
            const labels = [];
            
            // Helper to check for whole words only (prevents 'docker' matching 'doc')
            const hasWord = (text, word) => new RegExp(`\\b${word}\\b`, 'i').test(text);
            
            if (hasWord(title, 'bug') || hasWord(body, 'bug') || hasWord(title, 'error') || hasWord(title, 'fail')) {
              labels.push('bug');
            }
            if (hasWord(title, 'feature') || hasWord(title, 'request') || hasWord(title, 'enhancement')) {
              labels.push('enhancement');
            }
            if (hasWord(title, 'docs') || hasWord(title, 'documentation') || hasWord(body, 'guide')) {
              labels.push('documentation');
            }
            // UI/Frontend
            if (hasWord(title, 'ui') || hasWord(title, 'frontend') || hasWord(title, 'react') || hasWord(title, 'css')) {
              labels.push('ui');
            }
            // Backend/Ruby
            if (hasWord(title, 'ruby') || hasWord(body, 'ruby') || hasWord(title, 'gem')) {
              labels.push('ruby');
            }
            // Testing
            if (hasWord(title, 'test') || hasWord(title, 'tests') || hasWord(title, 'coverage') || hasWord(title, 'pytest')) {
              labels.push('tests');
            }
            // Infra/Docker/Helm
            if (hasWord(title, 'docker') || hasWord(body, 'container')) {
              labels.push('docker');
            }
            if (hasWord(title, 'helm') || hasWord(title, 'k8s') || hasWord(title, 'kubernetes') || hasWord(title, 'chart')) {
              labels.push('helm');
            }
            
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labels
              });
            }

      - name: Auto-Reply to User and Request Review
        if: github.event.issue.author_association == 'NONE'
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-comment'
          token: ${{ secrets.GITHUB_TOKEN }}
          body: |
            Hi @${{ github.actor }}, thanks for opening this issue! ðŸ¤–
            
            I have automatically assigned this to our admin @PoojasPatel013 for review.
            
            **Status:**
            - [x] Admin Assigned
            - [ ] Labels Applied (Check sidebar)
            - [ ] Under Review
            
            Please wait for further updates.
