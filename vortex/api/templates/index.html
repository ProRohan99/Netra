<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NETRA | Advanced Security Operations</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Theme Music: Looped & Autoplay -->
    <audio id="bg-music" loop autoplay>
        <source src="/static/theme.mp3" type="audio/mpeg">
    </audio>
    <script>
        // Ensure audio plays (browsers might block autoplay until interaction)
        document.addEventListener('click', function() {
            var audio = document.getElementById("bg-music");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }, {once: true});
    </script>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="logo-icon">N</div>
                <h1>NETRA</h1>
                <button class="btn-icon" onclick="toggleSidebar()"
                    style="margin-left:auto; background:none; border:none; color:#666; cursor:pointer;">‚óÄ</button>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="switchView('dashboard')">
                    <span class="icon">‚ö°</span> Dashboard
                </a>
                <a href="#" class="nav-item" onclick="switchView('history')">
                    <span class="icon">üìú</span> <span>Scan History</span>
                </a>
                <a href="#" class="nav-item" onclick="switchView('settings')">
                    <span class="icon">‚öôÔ∏è</span> <span>Settings</span>
                </a>
            </nav>

            <div class="status-panel">
                <div class="status-item">
                    <span class="label">Engine</span>
                    <span class="value online">ONLINE</span>
                </div>
                <div class="status-item">
                    <span class="label">Mode</span>
                    <span class="value mode-docker">DOCKER</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-bar">
                <div class="breadcrumbs">Dashboard / Overview</div>
                <div class="user-profile">
                    <div class="avatar">A</div>
                    <span>Admin</span>
                </div>
            </header>

            <!-- Dashboard View -->
            <div id="view-dashboard" class="content-view active">
                <div class="hero-section">
                    <h2>Vulnerability Scanners</h2>
                    <p>Initialize a new scan against a target infrastructure.</p>
                </div>

                <div class="scan-card">
                    <form id="scanForm" onsubmit="submitScan(event)">
                        <div class="form-group target-input-group">
                            <label for="target">TARGET URL / IP</label>
                            <div class="input-wrapper">
                                <input type="text" id="target" name="target" placeholder="e.g. example.com" required>
                                <button type="submit" class="btn-primary">
                                    <span class="icon">üöÄ</span> LAUNCH SCAN
                                </button>
                            </div>
                        </div>

                        <div class="options-grid">
                            <label class="toggle-card">
                                <input type="checkbox" name="cloud" checked>
                                <div class="card-content">
                                    <span class="card-icon">‚òÅÔ∏è</span>
                                    <span class="card-title">Cloud Infrastructure</span>
                                    <span class="card-desc">S3 Buckets & Misconfigs</span>
                                </div>
                            </label>

                            <label class="toggle-card">
                                <input type="checkbox" name="iot" checked>
                                <div class="card-content">
                                    <span class="card-icon">üì°</span>
                                    <span class="card-title">IoT Protocols</span>
                                    <span class="card-desc">MQTT & CoAP Fuzzing</span>
                                </div>
                            </label>

                            <label class="toggle-card">
                                <input type="checkbox" name="graphql">
                                <div class="card-content">
                                    <span class="card-icon">‚öõÔ∏è</span>
                                    <span class="card-title">GraphQL API</span>
                                    <span class="card-desc">Introspection Checks</span>
                                </div>
                            </label>

                            <label class="toggle-card">
                                <input type="checkbox" name="auto_exploit">
                                <div class="card-content">
                                    <span class="card-icon">‚öîÔ∏è</span>
                                    <span class="card-title">Auto Exploit</span>
                                    <span class="card-desc">Active Penetration</span>
                                </div>
                            </label>
                        </div>

                        <!-- Integrations -->
                        <div class="integrations-section"
                            style="margin-top:2rem; border-top:1px solid #333; padding-top:1rem;">
                            <h4 style="margin-bottom:1rem; color:#888;">EXTERNAL INTEGRATIONS</h4>
                            <div class="input-wrapper" style="gap:1rem; flex-wrap:wrap;">
                                <input type="text" name="defect_dojo_url"
                                    placeholder="DefectDojo URL (e.g. http://defectdojo.local)" style="flex:2">
                                <input type="password" name="defect_dojo_key" placeholder="API Key" style="flex:1">
                                <input type="number" name="engagement_id" placeholder="Engagement ID"
                                    style="flex:0.5; min-width:100px;">
                            </div>
                        </div>
                    </form>
                </div>

                <div class="recent-scans-preview">
                    <h3>Recent Operations</h3>
                    <div id="active-scans-list" class="scans-list">
                        <!-- Populated by JS -->
                        <div class="empty-state">No active scans running...</div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="content-view" style="display: none;">
                <h2>User Profile & Settings</h2>
                <div class="card" style="margin-top:1rem; padding:2rem;">
                    <form onsubmit="saveSettings(event)">
                        <h3 style="margin-bottom:1rem; color:var(--accent-primary);">User Profile</h3>
                        <div class="input-wrapper">
                            <input type="text" id="setting_username" placeholder="Your Name (Pentester)"
                                style="padding:0.8rem; background:#111; border:1px solid #333; color:white; width:100%;">
                        </div>

                        <h3 style="margin-top:2rem; margin-bottom:1rem; color:var(--accent-primary);">API Configuration
                        </h3>
                        <div class="input-wrapper">
                            <label style="display:block; margin-bottom:0.5rem; color:#888;">Default DefectDojo
                                URL</label>
                            <input type="text" id="setting_dd_url" placeholder="http://defectdojo.local"
                                style="padding:0.8rem; background:#111; border:1px solid #333; color:white; width:100%;">
                        </div>
                        <div class="input-wrapper" style="margin-top:1rem;">
                            <label style="display:block; margin-bottom:0.5rem; color:#888;">Default API Key</label>
                            <input type="password" id="setting_dd_key" placeholder="Token..."
                                style="padding:0.8rem; background:#111; border:1px solid #333; color:white; width:100%;">
                        </div>

                        <button type="submit" class="btn-primary" style="margin-top:2rem;">Save Settings</button>
                    </form>
                </div>
            </div>

            <!-- History View -->
            <div id="view-history" class="content-view" style="display: none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                    <h2>Scan History</h2>
                    <button onclick="refreshHistory()" class="btn-sm">üîÑ Refresh</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Target</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Scan Results</h2>
            <div class="json-viewer" id="jsonViewer"></div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>